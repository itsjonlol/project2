<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game - Submit Answer</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
</head>
<body>
    <h1>Game Prompt</h1>

    <p><strong>Game Code:</strong> <span id="gameCode" th:text="${gameCode}"></span></p>
    <p><strong>Prompt:</strong> <span id="gamePrompt"></span></p>

    <form id="answerForm">
        <input type="text" id="playerAnswer" placeholder="Enter your answer">
        <button type="submit">Submit Answer</button>
    </form>

    <script th:inline="javascript">
        const gameCode = /*[[${gameCode}]]*/ '';
        const playerName = /*[[${playerName}]]*/ '';
        const socket = new SockJS('/game');
        const stompClient = Stomp.over(socket);

        stompClient.connect({}, function () {
            stompClient.subscribe(`/topic/game/${gameCode}`, function (message) {
                const gameData = JSON.parse(message.body);
                const gamePrompt = document.getElementById("gamePrompt");
                gamePrompt.textContent = gameData.prompt;
            });
        });

        // Submit player's answer
        document.getElementById("answerForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const playerAnswer = document.getElementById("playerAnswer").value;
            stompClient.send(`/app/submitAnswer/${gameCode}`, {}, JSON.stringify({ player: playerName, answer: playerAnswer }));
        });
    </script>
</body>
</html>
